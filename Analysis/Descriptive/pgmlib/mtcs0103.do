* following step1_descriptive.sas by Karminderclearlog using "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/loglib/mtcs0103.log", replace textcapture set mem 100muse "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/datlib/smdat01", replace	label define vstatlab 	1	"1 Alive" 2	"2 alive as of 12/31/89, died after with DC" 3	"3 alive as of 12/31/89, died after without DC" 4	"4 died before 12/31/89, with DC" 5	"5 died before 12/31/89, without DC" 6	"6 unknown status"	label values vstat vstatlab* descriptive tables	table hiredate in 1/100	table dlo if vstat==6	*re-creating J. Robins' data	gen died = 0		replace died = 1 if dlo <= date("31dec1977", "DMY") & ( vstat == 4 | vstat == 5)	replace dlo = date("31dec1977", "DMY") if dlo > date("31dec1977", "DMY")	replace termdate = date("01jan1978", "DMY") if termdate > date("31dec1977", "DMY")	keep if hiredate > date("01jan1935", "DMY")			tab died	di _N	* durations and outcome summaries  	gen dur_emp = (termdate - hiredate)/365.25  	gen dur_fu  = (dlo - start_fu)/365.25  	gen cancer=0  	  	replace cancer = 1 if 140<=icd3 & icd3<=209  	gen respcan=0  	 	replace respcan = 1 if 160 <= icd3 & icd3 <=164  	gen age_entry=(start_fu-dob)/365.25  		replace age_entry=floor(age_entry)  	gen age_exit=(dlo-dob)/365.25  		replace age_exit=floor(age_exit)  		  	gen year = year(dlo)  	  	tab year if died==0	  	  	su dur_fu if died==0, detail  	  	tab1 cancer respcan died  	  	sum dur_emp dur_fu  			  				  	* create kaplan meier curve  	  	stset dur_fu, id(smid) failure(died)  		sts list   		sts graph, ci censored(single)  	  	stset dur_emp, id(smid) failure(died)  		sts list   		sts graph, ci censored(single)  	  	*alternative method  	quietly stcox, estimate basesurv(s)  	  	preserve  	bysort dur_fu: keep if _n == 1  	line s dur_emp  	restore  	* combine exposure and outcome datamerge smid using "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/datlib/smdat02", sort nokeep uniqm  		* plot looking at cumulative exposure by age (in first 1% of workers)	preserve	quietly su smid, detail	keep if smid <r(p1)		line cumas age  	  	restore  	  	preserve  		bysort age: egen meanas_atage = mean(cumas)  		bysort age: keep if _n==1  		line meanas_atage age  	restore  	  	  	log close