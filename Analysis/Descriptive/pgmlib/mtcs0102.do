*following checks in step 0 from Karminderlog using "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/loglib/mtcs0102.log", replace textclearcapture set mem 100m*use "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/datlib/smdat01", replace * exposure datause "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/datlib/smdat02", replace*create a long dataset with arsenic vars for each year (smdat03 in sas file)	keep smid age cumas	rename cumas as	reshape wide as, i(smid) j(age)*merge demographic data with long dataset	merge smid using "/Users/akeil/School/Outside Projects/CopperArsenic/Descriptive/datlib/smdat01", sort	drop _merge* table 1 from lubin 2000	* vital status	label define vstatlab 	1	"1 Alive" 2	"2 alive as of 12/31/89, died after with DC" 3	"3 alive as of 12/31/89, died after without DC" 4	"4 died before 12/31/89, with DC" 5	"5 died before 12/31/89, without DC" 6	"6 unknown status"	label values vstat vstatlab	tab vstat, missing		* durations and outcome summaries  	gen dur_emp = (termdate - hiredate)/365.25  	gen dur_fu  = (dlo - start_fu)/365.25  	gen cancer=0  	  	replace cancer = 1 if 140<=icd3 & icd3<=209  	gen respcan=0  	 	replace respcan = 1 if 160 <= icd3 & icd3 <=164  	gen age_entry=(start_fu-dob)/365.25  		replace age_entry=floor(age_entry)  	gen age_exit=(dlo-dob)/365.25  		replace age_exit=floor(age_exit)	summarize dur_emp dur_fu age_entry age_exit 	tab1 cancer respcan	age_exit age_entry	* cox PH models		stset age_exit, failure(respcan) entry(time age_entry)		gen ds = .		gen dsnum = .		local n = _N		forvalues id = 1/ `n' {			local agxt = age_exit[`id']			capture replace ds in `id' = as`agxt'			quietly  replace dsnum in `id' = age_exit[`id']		}		*replace ds = as87 if ds == .		replace ds = . if age_exit > 103 /* to bring to agreement with sas*/	*stcox ds, breslow	/*note - SAS program uses time varying exposure, STATA only able to implement 	using counting process methods, which require a differen structure */			*sts list	*sts graph, ci	*label define exflab 0 "0 all jobs coded 1" 1 "1 exposed" 2 "2 50% of work time in jobs coded unknown"log close